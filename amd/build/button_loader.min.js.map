{"version":3,"file":"button_loader.min.js","sources":["../src/button_loader.js"],"sourcesContent":["// This file is part of Moodle - https://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * Reusable controller to display a loader and disable a button while an action is being processed.\n *\n * @module      report_lifestory/button_loader\n * @copyright   2025 Datacurso\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as Str from 'core/str';\n\nexport const init = () => {\n    const buttons = document.querySelectorAll(\"#btn-feedback-ai\");\n\n    buttons.forEach(button => {\n        button.addEventListener(\"click\", async  e => {\n            if (button.classList.contains('report_lifestory-btnloading')) {\n                e.preventDefault();\n                return;\n            }\n\n            e.preventDefault();\n\n            const redirect = button.href || button.dataset.redirect;\n            const originalText = button.textContent.trim();\n            button.dataset.originalText = originalText;\n\n            const loaderText = await Str.get_string('generatingfeedback', 'report_lifestory');\n\n            // Show loader\n            button.classList.add('report_lifestory-btnloading');\n            button.setAttribute(\"aria-disabled\", \"true\");\n            button.style.pointerEvents = \"none\";\n            button.textContent = loaderText;\n\n            if (!redirect) {\n                return;\n            }\n\n            if (redirect.includes(\"action=csv\")) {\n                const iframe = document.createElement(\"iframe\");\n                iframe.style.display = \"none\";\n                iframe.src = redirect;\n                document.body.appendChild(iframe);\n\n                setTimeout(() => {\n                    button.classList.remove('report_lifestory-btnloading');\n                    button.removeAttribute(\"aria-disabled\");\n                    button.style.pointerEvents = \"\";\n                    button.textContent = originalText;\n                    iframe.remove();\n                }, 500);\n            } else {\n                window.location.href = redirect;\n            }\n        });\n    });\n};\n"],"names":["document","querySelectorAll","forEach","button","addEventListener","async","classList","contains","e","preventDefault","redirect","href","dataset","originalText","textContent","trim","loaderText","Str","get_string","add","setAttribute","style","pointerEvents","includes","iframe","createElement","display","src","body","appendChild","setTimeout","remove","removeAttribute","window","location"],"mappings":";;;;;;;yBAyBoB,KACAA,SAASC,iBAAiB,oBAElCC,SAAQC,SACZA,OAAOC,iBAAiB,SAASC,MAAAA,OACzBF,OAAOG,UAAUC,SAAS,2CAC1BC,EAAEC,iBAIND,EAAEC,uBAEIC,SAAWP,OAAOQ,MAAQR,OAAOS,QAAQF,SACzCG,aAAeV,OAAOW,YAAYC,OACxCZ,OAAOS,QAAQC,aAAeA,mBAExBG,iBAAmBC,IAAIC,WAAW,qBAAsB,uBAG9Df,OAAOG,UAAUa,IAAI,+BACrBhB,OAAOiB,aAAa,gBAAiB,QACrCjB,OAAOkB,MAAMC,cAAgB,OAC7BnB,OAAOW,YAAcE,WAEhBN,YAIDA,SAASa,SAAS,cAAe,OAC3BC,OAASxB,SAASyB,cAAc,UACtCD,OAAOH,MAAMK,QAAU,OACvBF,OAAOG,IAAMjB,SACbV,SAAS4B,KAAKC,YAAYL,QAE1BM,YAAW,KACP3B,OAAOG,UAAUyB,OAAO,+BACxB5B,OAAO6B,gBAAgB,iBACvB7B,OAAOkB,MAAMC,cAAgB,GAC7BnB,OAAOW,YAAcD,aACrBW,OAAOO,WACR,UAEHE,OAAOC,SAASvB,KAAOD"}