{"version":3,"file":"togglecategories.min.js","sources":["../src/togglecategories.js"],"sourcesContent":["/**\n * Controlador JS para expandir/colapsar categorías en el historial de estudiante.\n * Mantiene el estado expandido/colapsado usando localStorage por usuario y curso.\n */\nexport const init = () => {\n    const params = new URLSearchParams(window.location.search);\n    const userid = params.get('userid') || '0';\n    const courseid = params.get('id') || 'all';\n    const STORAGE_KEY = `history_student_ai_state_${userid}_${courseid}`;\n\n    // Cargar estado previo\n    let state = {};\n    try {\n        state = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};\n    } catch (e) {\n        state = {};\n    }\n\n    // Inicializa botones y aplica estado guardado\n    document.querySelectorAll(\".toggle-category\").forEach(button => {\n        const categoryId = button.dataset.categoryid;\n        const dataTarget = button.dataset.target;\n        let categoryRows = dataTarget ? document.querySelectorAll(dataTarget) : [];\n\n        if ((!dataTarget || categoryRows.length === 0) && categoryId) {\n            categoryRows = document.querySelectorAll(\"tr.cat_\" + categoryId);\n        }\n\n        // Aplica estado guardado (expandido o colapsado)\n        const savedExpanded = state[categoryId];\n        if (savedExpanded === false) {\n            categoryRows.forEach(row => (row.style.display = \"none\"));\n            button.setAttribute(\"aria-expanded\", \"false\");\n            button.querySelector(\".collapsed\")?.classList.remove(\"d-none\");\n            button.querySelector(\".expanded\")?.classList.add(\"d-none\");\n        } else if (savedExpanded === true) {\n            categoryRows.forEach(row => (row.style.display = \"\"));\n            button.setAttribute(\"aria-expanded\", \"true\");\n            button.querySelector(\".collapsed\")?.classList.add(\"d-none\");\n            button.querySelector(\".expanded\")?.classList.remove(\"d-none\");\n        }\n\n        // Evento de click para alternar y guardar estado\n        button.addEventListener(\"click\", e => {\n            e.preventDefault();\n            e.stopPropagation();\n\n            const isExpanded = button.getAttribute(\"aria-expanded\") === \"true\";\n\n            if (isExpanded) {\n                // Colapsar\n                categoryRows.forEach(row => (row.style.display = \"none\"));\n                button.setAttribute(\"aria-expanded\", \"false\");\n                button.querySelector(\".collapsed\")?.classList.remove(\"d-none\");\n                button.querySelector(\".expanded\")?.classList.add(\"d-none\");\n                state[categoryId] = false;\n            } else {\n                // Expandir\n                categoryRows.forEach(row => (row.style.display = \"\"));\n                button.setAttribute(\"aria-expanded\", \"true\");\n                button.querySelector(\".collapsed\")?.classList.add(\"d-none\");\n                button.querySelector(\".expanded\")?.classList.remove(\"d-none\");\n                state[categoryId] = true;\n            }\n\n            // Guardar estado actualizado\n            localStorage.setItem(STORAGE_KEY, JSON.stringify(state));\n        });\n    });\n\n    // Asegurar íconos iniciales correctos\n    document.querySelectorAll(\".toggle-category\").forEach(button => {\n        const isExpanded = button.getAttribute(\"aria-expanded\") === \"true\";\n        button.querySelector(\".collapsed\")?.classList.toggle(\"d-none\", isExpanded);\n        button.querySelector(\".expanded\")?.classList.toggle(\"d-none\", !isExpanded);\n    });\n};\n"],"names":["params","URLSearchParams","window","location","search","userid","get","courseid","STORAGE_KEY","state","JSON","parse","localStorage","getItem","e","document","querySelectorAll","forEach","button","categoryId","dataset","categoryid","dataTarget","target","categoryRows","length","savedExpanded","row","style","display","setAttribute","querySelector","classList","remove","add","addEventListener","preventDefault","stopPropagation","getAttribute","setItem","stringify","isExpanded","toggle"],"mappings":"kLAIoB,WACVA,OAAS,IAAIC,gBAAgBC,OAAOC,SAASC,QAC7CC,OAASL,OAAOM,IAAI,WAAa,IACjCC,SAAWP,OAAOM,IAAI,OAAS,MAC/BE,+CAA0CH,mBAAUE,cAGtDE,MAAQ,OAERA,MAAQC,KAAKC,MAAMC,aAAaC,QAAQL,eAAiB,GAC3D,MAAOM,GACLL,MAAQ,GAIZM,SAASC,iBAAiB,oBAAoBC,SAAQC,eAC5CC,WAAaD,OAAOE,QAAQC,WAC5BC,WAAaJ,OAAOE,QAAQG,WAC9BC,aAAeF,WAAaP,SAASC,iBAAiBM,YAAc,GAElEA,YAAsC,IAAxBE,aAAaC,SAAiBN,aAC9CK,aAAeT,SAASC,iBAAiB,UAAYG,mBAInDO,cAAgBjB,MAAMU,iEACN,IAAlBO,cACAF,aAAaP,SAAQU,KAAQA,IAAIC,MAAMC,QAAU,SACjDX,OAAOY,aAAa,gBAAiB,uCACrCZ,OAAOa,cAAc,sEAAeC,UAAUC,OAAO,yCACrDf,OAAOa,cAAc,uEAAcC,UAAUE,IAAI,eAC9C,IAAsB,IAAlBR,cAAwB,mDAC/BF,aAAaP,SAAQU,KAAQA,IAAIC,MAAMC,QAAU,KACjDX,OAAOY,aAAa,gBAAiB,uCACrCZ,OAAOa,cAAc,wEAAeC,UAAUE,IAAI,yCAClDhB,OAAOa,cAAc,uEAAcC,UAAUC,OAAO,UAIxDf,OAAOiB,iBAAiB,SAASrB,IAC7BA,EAAEsB,iBACFtB,EAAEuB,kHAE0D,SAAzCnB,OAAOoB,aAAa,kBAInCd,aAAaP,SAAQU,KAAQA,IAAIC,MAAMC,QAAU,SACjDX,OAAOY,aAAa,gBAAiB,wCACrCZ,OAAOa,cAAc,wEAAeC,UAAUC,OAAO,yCACrDf,OAAOa,cAAc,uEAAcC,UAAUE,IAAI,UACjDzB,MAAMU,aAAc,IAGpBK,aAAaP,SAAQU,KAAQA,IAAIC,MAAMC,QAAU,KACjDX,OAAOY,aAAa,gBAAiB,uCACrCZ,OAAOa,cAAc,wEAAeC,UAAUE,IAAI,yCAClDhB,OAAOa,cAAc,uEAAcC,UAAUC,OAAO,UACpDxB,MAAMU,aAAc,GAIxBP,aAAa2B,QAAQ/B,YAAaE,KAAK8B,UAAU/B,cAKzDM,SAASC,iBAAiB,oBAAoBC,SAAQC,kEAC5CuB,WAAsD,SAAzCvB,OAAOoB,aAAa,gDACvCpB,OAAOa,cAAc,wEAAeC,UAAUU,OAAO,SAAUD,4CAC/DvB,OAAOa,cAAc,yEAAcC,UAAUU,OAAO,UAAWD"}