{"version":3,"file":"user_search.min.js","sources":["../src/user_search.js"],"sourcesContent":["// This file is part of Moodle - https://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * Provides live user search functionality for the lifestory report, including AJAX requests and dynamic result rendering.\n *\n * @module      report_lifestory/user_search\n * @copyright   2025 Datacurso\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/templates', 'core/notification'],\n    function ($, Ajax, Templates, Notification) {\n\n        let searchTimeout = null;\n        const SEARCH_DELAY = 300;\n\n        /**\n         * Calls the external function to search for students.\n         * @param {string} query Search term entered by the user.\n         * @return {Promise}\n         */\n        const searchStudents = function (query) {\n            return Ajax.call([{\n                methodname: 'report_lifestory_search_students',\n                args: { query: query }\n            }])[0];\n        };\n\n        /**\n         * Renders the search results using a Mustache template.\n         * @param {Array} students List of student objects returned by the webservice.\n         * @param {string} baseUrl Base URL of the report.\n         */\n        const renderResults = function (students, baseUrl) {\n            const container = $('#search-results');\n            container.empty();\n\n            if (!students || students.length === 0) {\n                container.addClass('d-none');\n                return;\n            }\n\n            const context = {\n                students: students.map(student => ({\n                    id: student.id,\n                    fullname: student.fullname,\n                    email: student.email,\n                    profileimageurl: student.profileimageurl,\n                    baseurl: baseUrl,\n                    initial: student.fullname.charAt(0).toUpperCase()\n                }))\n            };\n\n            Templates.render('report_lifestory/search_results', context)\n                .then(function (html, js) {\n                    container.html(html).removeClass('d-none');\n                    Templates.runTemplateJS(js);\n                })\n                .catch(Notification.exception);\n        };\n\n        /**\n         * Initializes the user search functionality.\n         * @param {string} baseUrl Base URL for the current page.\n         */\n        const init = function (baseUrl) {\n            const searchInput = $('#usersearch');\n            const clearButton = $('#clearsearch');\n            const resultsContainer = $('#search-results');\n\n            if (searchInput.length === 0) {\n                return;\n            }\n\n            // Input event\n            searchInput.on('input', function () {\n                const query = $(this).val().trim();\n\n                if (query.length === 0) {\n                    clearButton.hide();\n                    resultsContainer.addClass('d-none').empty();\n                    return;\n                }\n\n                clearButton.show();\n\n                if (searchTimeout) {\n                    clearTimeout(searchTimeout);\n                }\n\n                searchTimeout = setTimeout(function () {\n                    searchStudents(query)\n                        .then(function (response) {\n                            const students = response && response.students ? response.students : [];\n                            renderResults(students, baseUrl);\n                        })\n                        .catch(Notification.exception);\n                }, SEARCH_DELAY);\n            });\n\n            // Clear input\n            clearButton.on('click', function (e) {\n                e.preventDefault();\n                searchInput.val('');\n                clearButton.hide();\n                resultsContainer.addClass('d-none').empty();\n                searchInput.focus();\n            });\n\n            // Show results when input is focused\n            searchInput.on('focus', function () {\n                const query = $(this).val().trim();\n                if (query.length > 0 && resultsContainer.children().length > 0) {\n                    resultsContainer.removeClass('d-none');\n                }\n            });\n\n            // Hide results when clicking outside\n            $(document).on('click', function (e) {\n                if (!$(e.target).closest('#usersearch-wrapper').length) {\n                    resultsContainer.addClass('d-none');\n                }\n            });\n\n            // Prevent submitting form with Enter\n            searchInput.on('keydown', function (e) {\n                if (e.key === 'Enter') {\n                    e.preventDefault();\n                }\n            });\n        };\n\n        return { init: init };\n    });\n"],"names":["define","$","Ajax","Templates","Notification","searchTimeout","init","baseUrl","searchInput","clearButton","resultsContainer","length","on","query","this","val","trim","hide","addClass","empty","show","clearTimeout","setTimeout","call","methodname","args","searchStudents","then","response","students","container","context","map","student","id","fullname","email","profileimageurl","baseurl","initial","charAt","toUpperCase","render","html","js","removeClass","runTemplateJS","catch","exception","renderResults","e","preventDefault","focus","children","document","target","closest","key"],"mappings":";;;;;;;AAuBAA,sCAAO,CAAC,SAAU,YAAa,iBAAkB,sBAC7C,SAAUC,EAAGC,KAAMC,UAAWC,kBAEtBC,cAAgB,WAuHb,CAAEC,KAnEI,SAAUC,eACbC,YAAcP,EAAE,eAChBQ,YAAcR,EAAE,gBAChBS,iBAAmBT,EAAE,mBAEA,IAAvBO,YAAYG,SAKhBH,YAAYI,GAAG,SAAS,iBACdC,MAAQZ,EAAEa,MAAMC,MAAMC,UAEP,IAAjBH,MAAMF,cACNF,YAAYQ,YACZP,iBAAiBQ,SAAS,UAAUC,QAIxCV,YAAYW,OAERf,eACAgB,aAAahB,eAGjBA,cAAgBiB,YAAW,YArEZ,SAAUT,cACtBX,KAAKqB,KAAK,CAAC,CACdC,WAAY,mCACZC,KAAM,CAAEZ,MAAOA,UACf,IAkEIa,CAAeb,OACVc,MAAK,SAAUC,WA3DV,SAAUC,SAAUtB,eAChCuB,UAAY7B,EAAE,sBACpB6B,UAAUX,SAELU,UAAgC,IAApBA,SAASlB,mBACtBmB,UAAUZ,SAAS,gBAIjBa,QAAU,CACZF,SAAUA,SAASG,KAAIC,WACnBC,GAAID,QAAQC,GACZC,SAAUF,QAAQE,SAClBC,MAAOH,QAAQG,MACfC,gBAAiBJ,QAAQI,gBACzBC,QAAS/B,QACTgC,QAASN,QAAQE,SAASK,OAAO,GAAGC,mBAI5CtC,UAAUuC,OAAO,kCAAmCX,SAC/CJ,MAAK,SAAUgB,KAAMC,IAClBd,UAAUa,KAAKA,MAAME,YAAY,UACjC1C,UAAU2C,cAAcF,OAE3BG,MAAM3C,aAAa4C,WAoCRC,CADiBrB,UAAYA,SAASC,SAAWD,SAASC,SAAW,GAC7CtB,YAE3BwC,MAAM3C,aAAa4C,aAlFf,QAuFjBvC,YAAYG,GAAG,SAAS,SAAUsC,GAC9BA,EAAEC,iBACF3C,YAAYO,IAAI,IAChBN,YAAYQ,OACZP,iBAAiBQ,SAAS,UAAUC,QACpCX,YAAY4C,WAIhB5C,YAAYI,GAAG,SAAS,WACNX,EAAEa,MAAMC,MAAMC,OAClBL,OAAS,GAAKD,iBAAiB2C,WAAW1C,OAAS,GACzDD,iBAAiBmC,YAAY,aAKrC5C,EAAEqD,UAAU1C,GAAG,SAAS,SAAUsC,GACzBjD,EAAEiD,EAAEK,QAAQC,QAAQ,uBAAuB7C,QAC5CD,iBAAiBQ,SAAS,aAKlCV,YAAYI,GAAG,WAAW,SAAUsC,GAClB,UAAVA,EAAEO,KACFP,EAAEC"}