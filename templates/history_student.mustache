{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template report_lifestory/history_student

    Example context (json):
    {
    }
}}

<div class="mb-4 report_lifestory-form">
    <div class="d-flex align-items-center flex-wrap justify-content-between gap-3 report_lifestory-header">

        <div class="d-flex align-items-center flex-wrap gap-3 report_lifestory-actions">

            <div id="usersearch-wrapper" class="position-relative" style="min-width: 300px;">
                {{^selecteduser}}
                    <form method="get" {{#baseurl}}action="{{baseurl}}"{{/baseurl}} id="usersearchform">
                        <input type="text"
                               name="searchvalue"
                               id="usersearch"
                               class="form-control pe-4"
                               placeholder="{{#str}} searchusers, report_lifestory {{/str}}"
                               value="{{searchvalue}}"
                               autocomplete="off">

                        <div id="search-results"
                             class="position-absolute bg-white border rounded shadow-sm mt-1 w-100 d-none"
                             style="z-index: 1000; max-height: 300px; overflow-y: auto;">
                        </div>
                    </form>
                {{/selecteduser}}

                {{#selecteduser}}
                    <div class="d-flex align-items-center">
                        <input type="text"
                               class="form-control"
                               value="{{fullname}}"
                               readonly>
                        <a href="{{baseurl}}"
                           class="ms-2 text-primary text-decoration-underline"
                           style="white-space: nowrap;">
                            {{#str}} clearselection, report_lifestory {{/str}}
                        </a>
                    </div>
                {{/selecteduser}}
            </div>

            {{#hasuser}}
            <div class="d-flex align-items-center gap-2 ms-3 report_lifestory-actionbuttons">
                <a href="{{baseurl}}?userid={{userid}}&action=feedback"
                   class="btn btn-primary me-2"
                   id="btn-feedback-ai"
                   data-loader-text="{{#str}} generatingfeedback, report_lifestory {{/str}}">
                    {{#str}} generatefeedback, report_lifestory {{/str}}
                </a>
                <a href="{{baseurl}}?userid={{userid}}&action=csv"
                   class="btn btn-success"
                   id="btn-csv-export">
                    {{#str}} exportcsv, report_lifestory {{/str}}
                </a>
            </div>
            {{/hasuser}}
        </div>

        {{#hasuser}}
        {{#headerlogo}}
        <div class="d-flex align-items-center ms-auto report_lifestory-logo">
            <img src="{{logourl}}" alt="Logo Datacurso" class="report_lifestory-pluginlogo">
        </div>
        {{/headerlogo}}
        {{/hasuser}}
    </div>
</div>

{{^hasuser}}
<div class="alert alert-info report_lifestory-alert">
    {{#str}} selectuser, report_lifestory {{/str}}
</div>
{{/hasuser}}

{{#hasuser}}
    {{#showfeedback}}
    <div class="alert alert-info mb-4 p-3 report_lifestory-feedback">
        <h5 class="mb-3">{{#str}} feedbackfromai, report_lifestory {{/str}}</h5>
        <div class="bg-light p-3 rounded mb-0 report_lifestory-feedbackcontent">
            {{{feedback}}}
        </div>
    </div>
    {{/showfeedback}}

    {{#courses}}
    <div class="mb-5 report_lifestory-course">
        <h4 class="mb-3">{{fullname}}</h4>
        <div class="report-table border rounded p-3 bg-white shadow-sm">
            {{{reporthtml}}}
        </div>
    </div>
    {{/courses}}
{{/hasuser}}
